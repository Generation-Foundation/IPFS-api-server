// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model File {
  id      Int     @id @default(autoincrement())
  cid  String 
  account String //업로드한 계정
  size String 
  mimetype String  //확장자명
  file_id String @unique
  uploaded_at DateTime @default(now())

  Product Product? //1:1 관계
}

model Product {
  id      Int     @id @default(autoincrement())
  file_id String @unique 
  seller String //판매자
  name  String //상품명
  content String //상품설명
  price Int //상품가격
  thumbnail_url String 
  is_public Boolean @default(true) //공개, 비공개
  status Boolean @default(true) //판매중 or 판매종료
  volume_to_sales Int @default(0) //판매량
  limit_of_sales Int @default(1) //최대 판매량
  uploaded_at DateTime @default(now())

  file File @relation(fields: [file_id], references: [file_id])

  Product_required_token Product_required_token[] //1:N 관계
  Product_order_history Order_history[] //1:N 관계
  Product_image Product_image[] //1:N 관계
  
  @@index([seller], name: "seller")
  @@index([status], name: "status")
  @@index([volume_to_sales], name: "volume_to_sales")
  @@index([uploaded_at], name: "uploaded_at")
}

model Product_image {
  id      Int     @id @default(autoincrement())
  image_url String
  product_id Int

  product Product @relation(fields: [product_id], references: [id])
}

model Token {
  id      Int     @id @default(autoincrement())
  contract  String @unique
  symbol String
  name String

  Product_required_token Product_required_token[] //1:N 관계
}

model Product_required_token {
  id      Int     @id @default(autoincrement())
  product_id Int
  token_id Int

  product Product @relation(fields: [product_id], references: [id])
  token Token @relation(fields: [token_id], references: [id])

  Order_history Order_history[] // N:M 관계

  @@index([product_id], name: "product_id")
  @@index([token_id], name: "token_id")
}

model Order_history {
  id      Int     @id @default(autoincrement())
  product_id  Int 
  product_buyer String
  exchange_rate String
  token String
  status String @default("ORDER_COMPLETE") //거래완료 or 거래취소(환불)
  created_at DateTime @default(now())
  
  product Product @relation(fields: [product_id], references: [id])

  report_record Report_record? //1:1 관계
  Product_required_token Product_required_token[] //N:M 관계
}

model Report_record {
  id      Int     @id @default(autoincrement())
  order_history_id  Int @unique
  content String
  created_at DateTime @default(now())
  author String

  order_history Order_history @relation(fields: [order_history_id], references: [id])
}